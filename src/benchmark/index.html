<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Translations Benchmark</title>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const textContainer = document.getElementById('text');
      const textToCountContainer = document.getElementById('textCount');

      const userAgent = document.getElementById("userAgent")
      const totalWords = document.getElementById("totalWords");
      const totalTokens = document.getElementById("totalTokens");
      const benchmarkTime = document.getElementById("benchmarkTime");
      const wordsPerSecond = document.getElementById("wordsPerSecond");
      const tokensPerSecond = document.getElementById("tokensPerSecond");

      // This isn't a 1:1 mapping of the tokenization.
      const wordCount = textToCountContainer.innerText.split(/\s+/).filter(t => t).length
      const tokenCount = 10950;

      totalWords.innerText = wordCount;
      totalTokens.innerText = tokenCount;
      userAgent.innerText = navigator.userAgent

      // Translations shouldn't take longer than 2 seconds. This is how we know we are done,
      // when there are no new mutations.
      const doneDebounce = 4000;

      let timeoutId;
      let startTime;
      let endTime;

      function reportResults() {
        const durationSeconds = (endTime - startTime) / 1000;
        const wps = wordCount / durationSeconds;
        const tps = tokenCount / durationSeconds;
        benchmarkTime.innerText = `${(durationSeconds).toFixed(2)} seconds`
        wordsPerSecond.innerText = `${wps.toFixed(2)} wps`
        tokensPerSecond.innerText = `${tps.toFixed(2)} tps`
      }

      const observer = new MutationObserver((mutationsList, observer) => {
        console.log(`!!! mutation`);
        if (!timeoutId) {
          startTime = performance.now()
        }
        endTime = performance.now()
        clearTimeout(timeoutId)
        timeoutId = setTimeout(reportResults, doneDebounce);
      });

      observer.observe(textContainer, {
        subtree: true,
        characterData: true,
        childList: true
      });

      console.log("Test is ready.");
    });
  </script>
  <style>
    #instructions {
      border: 1px solid black;
      border-radius: 10px;
      margin: 20px;
      padding: 20px;
      font-size: 1.2em;
      font-family: sans-serif;
    }
    #text {
      padding: 50px;
      font-size: 10pt;
    }
    body {
      display: flex;
    }
    body > * {
      flex: 1;
    }
  </style>
</head>
<body>
  <!-- This node will get translated, but not included in the results. -->
  <div id="text">
    <div class="chapter" id="textCount">
      <h3 style="text-align: center;" class="xhtml_h3_align">
        <h3>
        They Meet the Wooden Gargoyles
        </h3>

        <p>
        Another breathless climb brought our adventurers to a third landing
        where there was a rift in the mountain.  On peering out all they could
        see was rolling banks of clouds, so thick that they obscured all else.
        </p>
        
        <p>
        But the travellers were obliged to rest, and while they were sitting on
        the rocky floor the Wizard felt in his pocket and brought out the nine
        tiny piglets.  To his delight they were now plainly visible, which
        proved that they had passed beyond the influence of the magical Valley
        of Voe.
        </p>
        
        <p>
        "Why, we can see each other again!" cried one, joyfully.
        </p>
        
        <p>
        "Yes," sighed Eureka; "and I also can see you again, and the sight
        makes me dreadfully hungry.  Please, Mr. Wizard, may I eat just one of
        the fat little piglets?  You'd never miss ONE of them, I'm sure!"
        </p>
        
        <p>
        "What a horrid, savage beast!" exclaimed a piglet; "and after we've
        been such good friends, too, and played with one another!"
        </p>
        
        <p>
        "When I'm not hungry, I love to play with you all," said the kitten,
        demurely; "but when my stomach is empty it seems that nothing would
        fill it so nicely as a fat piglet."
        </p>
        
        <p>
        "And we trusted you so!" said another of the nine, reproachfully.
        </p>
        
        <p>
        "And thought you were respectable!" said another.
        </p>
        
        <p>
        "It seems we were mistaken," declared a third, looking at the kitten
        timorously, "no one with such murderous desires should belong to our
        party, I'm sure."
        </p>
        
        <p>
        "You see, Eureka," remarked Dorothy, reprovingly, "you are making
        yourself disliked.  There are certain things proper for a kitten to
        eat; but I never heard of a kitten eating a pig, under ANY cir'stances."
        </p>
        
        <p>
        "Did you ever see such little pigs before?" asked the kitten.  "They
        are no bigger than mice, and I'm sure mice are proper for me to eat."
        </p>
        
        <p>
        "It isn't the bigness, dear; its the variety," replied the girl.
        "These are Mr. Wizard's pets, just as you are my pet, and it wouldn't
        be any more proper for you to eat them than it would be for Jim to eat
        you."
        </p>
        
        <p>
        "And that's just what I shall do if you don't let those little balls of
        pork alone," said Jim, glaring at the kitten with his round, big eyes.
        "If you injure any one of them I'll chew you up instantly."
        </p>
        
        <p>
        The kitten looked at the horse thoughtfully, as if trying to decide
        whether he meant it or not.
        </p>
        
        <p>
        "In that case," she said, "I'll leave them alone.  You haven't many
        teeth left, Jim, but the few you have are sharp enough to make me
        shudder.  So the piglets will be perfectly safe, hereafter, as far as I
        am concerned."
        </p>
        
        <p>
        "That is right, Eureka," remarked the Wizard, earnestly.  "Let us all
        be a happy family and love one another."
        </p>
        
        <p>
        Eureka yawned and stretched herself.
        </p>
        
        <p>
        "I've always loved the piglets," she said; "but they don't love me."
        </p>
        
        <p>
        "No one can love a person he's afraid of," asserted Dorothy.  "If you
        behave, and don't scare the little pigs, I'm sure they'll grow very
        fond of you."
        </p>
        
        <p>
        The Wizard now put the nine tiny ones back into his pocket and the
        journey was resumed.
        </p>
        
        <p>
        "We must be pretty near the top, now," said the boy, as they climbed
        wearily up the dark, winding stairway.
        </p>
        
        <p>
        "The Country of the Gurgles can't be far from the top of the earth,"
        remarked Dorothy.  "It isn't very nice down here.  I'd like to get home
        again, I'm sure."
        </p>
        
        <p>
        No one replied to this, because they found they needed all their breath
        for the climb.  The stairs had become narrower and Zeb and the Wizard
        often had to help Jim pull the buggy from one step to another, or keep
        it from jamming against the rocky walls.
        </p>
        
        <p>
        At last, however, a dim light appeared ahead of them, which grew
        clearer and stronger as they advanced.
        </p>
        
        <p>
        "Thank goodness we're nearly there!" panted the little Wizard.
        </p>
        
        <p>
        Jim, who was in advance, saw the last stair before him and stuck his
        head above the rocky sides of the stairway.  Then he halted, ducked
        down and began to back up, so that he nearly fell with the buggy onto
        the others.
        </p>
        
        <p>
        "Let's go down again!" he said, in his hoarse voice.
        </p>
        
        <p>
        "Nonsense!" snapped the tired Wizard.  "What's the matter with you, old
        man?"
        </p>
        
        <p>
        "Everything," grumbled the horse.  "I've taken a look at this place,
        and it's no fit country for real creatures to go to.  Everything's
        dead, up there—no flesh or blood or growing thing anywhere."
        </p>
        
        <p>
        "Never mind; we can't turn back," said Dorothy; "and we don't intend to
        stay there, anyhow."
        </p>
        
        <p>
        "It's dangerous," growled Jim, in a stubborn tone.
        </p>
        
        <p>
        "See here, my good steed," broke in the Wizard, "little Dorothy and I
        have been in many queer countries in our travels, and always escaped
        without harm.  We've even been to the marvelous Land of Oz—haven't we,
        Dorothy?—so we don't much care what the Country of the Gargoyles is
        like.  Go ahead, Jim, and whatever happens we'll make the best of it."
        </p>
        
        <p>
        "All right," answered the horse; "this is your excursion, and not mine;
        so if you get into trouble don't blame me."
        </p>
        
        <p>
        With this speech he bent forward and dragged the buggy up the remaining
        steps.  The others followed and soon they were all standing upon a
        broad platform and gazing at the most curious and startling sight their
        eyes had ever beheld.
        </p>
        
        <p>
        "The Country of the Gargoyles is all wooden!" exclaimed Zeb; and so it
        was.  The ground was sawdust and the pebbles scattered around were hard
        knots from trees, worn smooth in course of time.  There were odd wooden
        houses, with carved wooden flowers in the front yards.  The tree-trunks
        were of coarse wood, but the leaves of the trees were shavings.  The
        patches of grass were splinters of wood, and where neither grass nor
        sawdust showed was a solid wooden flooring.  Wooden birds fluttered
        among the trees and wooden cows were browsing upon the wooden grass;
        but the most amazing things of all were the wooden people—the
        creatures known as Gargoyles.
        </p>
        
        <p>
        These were very numerous, for the place was thickly inhabited, and a
        large group of the queer people clustered near, gazing sharply upon the
        strangers who had emerged from the long spiral stairway.
        </p>
        
        <p>
        The Gargoyles were very small of stature, being less than three feet in
        height.  Their bodies were round, their legs short and thick and their
        arms extraordinarily long and stout.  Their heads were too big for
        their bodies and their faces were decidedly ugly to look upon.  Some
        had long, curved noses and chins, small eyes and wide, grinning mouths.
        Others had flat noses, protruding eyes, and ears that were shaped like
        those of an elephant.  There were many types, indeed, scarcely two
        being alike; but all were equally disagreeable in appearance.  The tops
        of their heads had no hair, but were carved into a variety of fantastic
        shapes, some having a row of points or balls around the top, others
        designs resembling flowers or vegetables, and still others having
        squares that looked like waffles cut criss-cross on their heads.  They
        all wore short wooden wings which were fastened to their wooden bodies
        by means of wooden hinges with wooden screws, and with these wings they
        flew swiftly and noiselessly here and there, their legs being of little
        use to them.
        </p>
        
        <p>
        This noiseless motion was one of the most peculiar things about the
        Gargoyles.  They made no sounds at all, either in flying or trying to
        speak, and they conversed mainly by means of quick signals made with
        their wooden fingers or lips.  Neither was there any sound to be heard
        anywhere throughout the wooden country.  The birds did not sing, nor
        did the cows moo; yet there was more than ordinary activity everywhere.
        </p>
        
        <p>
        The group of these queer creatures which was discovered clustered near
        the stairs at first remained staring and motionless, glaring with evil
        eyes at the intruders who had so suddenly appeared in their land.  In
        turn the Wizard and the children, the horse and the kitten, examined
        the Gargoyles with the same silent attention.
        </p>
        
        <p>
        "There's going to be trouble, I'm sure," remarked the horse.  "Unhitch
        those tugs, Zeb, and set me free from the buggy, so I can fight
        comfortably."
        </p>
        
        <p>
        "Jim's right," sighed the Wizard.  "There's going to be trouble, and my
        sword isn't stout enough to cut up those wooden bodies—so I shall have
        to get out my revolvers."
        </p>
        
        <p>
        He got his satchel from the buggy and, opening it, took out two deadly
        looking revolvers that made the children shrink back in alarm just to
        look at.
        </p>
        
        <p>
        "What harm can the Gurgles do?" asked Dorothy.  "They have no weapons
        to hurt us with."
        </p>
        
        <p>
        "Each of their arms is a wooden club," answered the little man, "and
        I'm sure the creatures mean mischief, by the looks of their eyes.  Even
        these revolvers can merely succeed in damaging a few of their wooden
        bodies, and after that we will be at their mercy."
        </p>
        
        <p>
        "But why fight at all, in that case?" asked the girl.
        </p>
        
        <p>
        "So I may die with a clear conscience," returned the Wizard, gravely.
        "It's every man's duty to do the best he knows how; and I'm going to do
        it."
        </p>
        
        <p>
        "Wish I had an axe," said Zeb, who by now had unhitched the horse.
        </p>
        
        <p>
        "If we had known we were coming we might have brought along several
        other useful things," responded the Wizard.  "But we dropped into this
        adventure rather unexpectedly."
        </p>
        
        <p>
        The Gargoyles had backed away a distance when they heard the sound of
        talking, for although our friends had spoken in low tones their words
        seemed loud in the silence surrounding them.  But as soon as the
        conversation ceased, the grinning, ugly creatures arose in a flock and
        flew swiftly toward the strangers, their long arms stretched out before
        them like the bowsprits of a fleet of sail-boats.  The horse had
        especially attracted their notice, because it was the biggest and
        strangest creature they had ever seen; so it became the center of their
        first attack.
        </p>
        
        <p>
        But Jim was ready for them, and when he saw them coming he turned his
        heels toward them and began kicking out as hard as he could.  Crack!
        crash! bang! went his iron-shod hoofs against the wooden bodies of the
        Gargoyles, and they were battered right and left with such force that
        they scattered like straws in the wind.  But the noise and clatter
        seemed as dreadful to them as Jim's heels, for all who were able
        swiftly turned and flew away to a great distance.  The others picked
        themselves up from the ground one by one and quickly rejoined their
        fellows, so for a moment the horse thought he had won the fight with
        ease.
        </p>
        
        <p>
        But the Wizard was not so confident.
        </p>
        
        <p>
        "Those wooden things are impossible to hurt," he said, "and all the
        damage Jim has done to them is to knock a few splinters from their
        noses and ears.  That cannot make them look any uglier, I'm sure, and
        it is my opinion they will soon renew the attack."
        </p>
        
        <p>
        "What made them fly away?" asked Dorothy.
        </p>
        
        <p>
        "The noise, of course.  Don't you remember how the Champion escaped
        them by shouting his battle-cry?"
        </p>
        
        <p>
        "Suppose we escape down the stairs, too," suggested the boy.  "We have
        time, just now, and I'd rather face the invis'ble bears than those
        wooden imps."
        </p>
        
        <p>
        "No," returned Dorothy, stoutly, "it won't do to go back, for then we
        would never get home.  Let's fight it out."
        </p>
        
        <p>
        "That is what I advise," said the Wizard.  "They haven't defeated us
        yet, and Jim is worth a whole army."
        </p>
        
        <p>
        But the Gargoyles were clever enough not to attack the horse the next
        time.  They advanced in a great swarm, having been joined by many more
        of their kind, and they flew straight over Jim's head to where the
        others were standing.
        </p>
        
        <p>
        The Wizard raised one of his revolvers and fired into the throng of his
        enemies, and the shot resounded like a clap of thunder in that silent
        place.
        </p>
        
        <p>
        Some of the wooden beings fell flat upon the ground, where they
        quivered and trembled in every limb; but most of them managed to wheel
        and escape again to a distance.
        </p>
        
        <p>
        Zeb ran and picked up one of the Gargoyles that lay nearest to him.
        The top of its head was carved into a crown and the Wizard's bullet had
        struck it exactly in the left eye, which was a hard wooden knot.  Half
        of the bullet stuck in the wood and half stuck out, so it had been the
        jar and the sudden noise that had knocked the creature down, more than
        the fact that it was really hurt.  Before this crowned Gargoyle had
        recovered himself Zeb had wound a strap several times around its body,
        confining its wings and arms so that it could not move.  Then, having
        tied the wooden creature securely, the boy buckled the strap and tossed
        his prisoner into the buggy.  By that time the others had all retired.
        </p>
    </div>
  </div>
  <div id="instructions" lang="en" translate="no">
    <!-- These will be ignored by the translations.-->
    <h2>Translations Benchmark</h2>
    <div><b>Instructions</b>: Translate this page from Spanish to English, and the results will be reported here. If you are benchmarking an implementation with intersection observers, scroll through the page.</div>
    <p>User Agent: <b id="userAgent"></b></p>
    <p>Total words: <b id="totalWords"></b></p>
    <p>Total tokens: ~<b id="totalTokens"></b></p>
    <p>Benchmark time: <b id="benchmarkTime"></b></p>
    <p>Words per second: <b id="wordsPerSecond"></b></p>
    <p>Tokens per second: <b id="tokensPerSecond"></b></p>
    <div id="results">
    </div>
  </div>
</body>
</html>
